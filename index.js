!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r,a,o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e};r=L.map("map").setView([42.69793,23.321628],13),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <createCoordinatesReturn href="http://openstreetmap.org">OpenStreetMap</createCoordinatesReturn> contributors, <createCoordinatesReturn href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</createCoordinatesReturn>, Imagery Â© <createCoordinatesReturn href="http://mapbox.com">Mapbox</createCoordinatesReturn>',maxZoom:18,id:"mapbox.streets-basic",accessToken:"pk.eyJ1IjoiY2hpcHNhbiIsImEiOiJqa0JwV1pnIn0.mvduWzyRdcHxK_QIOpetFg"}).addTo(r);L.control.sidebar("sidebar").addTo(r);a=new L.FeatureGroup,r.addLayer(a);var i=new L.Control.Draw({edit:{featureGroup:a},draw:{circle:!1,circlemarker:!1,marker:!1,polygon:!1,polyline:!1}});function c(e,t,n,r){void 0===n&&(n=300),void 0===r&&(r={});var a=o({color:"red"},r);e.forEach(function(e){new L.Circle(e,n,a).addTo(t)})}r.addControl(i);var s=6371e3;function l(e,t,n){void 0===t&&(t=500);var r,a,o=Number(t)/s,i=d(Number(n)),c=d(e.lat),l=d(e.lng),u=Math.sin(c),h=Math.cos(c),f=Math.sin(o),g=Math.cos(o),v=Math.sin(i),m=u*g+h*f*Math.cos(i),b=Math.asin(m),y=v*f*h,M=g-u*m,w=l+Math.atan2(y,M),O=L.latLng(p(b),(p(w)+540)%360-180);return{point:O,new_bearing:(r=e,a=O,(function(e,t){var n=d(e.lat),r=d(t.lat),a=d(t.lng-e.lng),o=Math.sin(a)*Math.cos(r),i=Math.cos(n)*Math.sin(r)-Math.sin(n)*Math.cos(r)*Math.cos(a);return(p(Math.atan2(o,i))+360)%360}(a,r)+180)%360)}}function u(e,t,n){void 0===n&&(n=5);var r=function(e){return r=n,a=(t=e).toString().split(".")[1].length,function(e,t){return t=Math.pow(10,t),Math.ceil(e*t)/t}(t,a-r);var t,r,a},a=e.map(r),o=r(t),i=Math.min.apply(Math,a),c=Math.max.apply(Math,a);return i<=o&&o<=c}function d(e){return e*Math.PI/180}function p(e){return 180*e/Math.PI}var h,f,g,v,m;function b(e,t,n){for(var r=e.getEast(),a=[],o=t;a.push(o),u([t.lng,r],o.lng);)o=l(o,n,h.east).point;return a}function y(e,t){return l(l(e,t/2,h.south).point,t/2,h.east).point}!function(e){e[e.east=90]="east",e[e.west=-90]="west",e[e.north=0]="north",e[e.south=180]="south"}(h||(h={})),function(e){e.northWest="NorthWest"}(f||(f={})),m=(new L.FeatureGroup).addTo(r),$("#radius-size").attr("value",150),g=function(e,t){e.clearLayers();var n=document.getElementById("regenerate-btn");n.onclick=function(e,t){t.clearLayers();var n=Number($("#radius-size").val());console.log(n+"m circle radius");var r=function(e){for(var t=[],n=[],r=e.boundingRectangle.getBounds(),a=Object.freeze(r.getNorthWest()),o=a,i=o,c=1;;c++){var s=b(r,i,e.distance);t.push.apply(t,s);var d=y(i,e.distance);if(!u([r.getNorth(),r.getSouth()],o.lat))break;var p=b(r,d,e.distance);p.pop(),n.push.apply(n,p),i=o=l(a,e.distance*c,h.south).point}return{main:t,fillers:n,combined:t.concat(n)}}({boundingRectangle:e,distance:2*n});c(r.main,t,n),c(r.fillers,t,n,{color:"green"});var a=document.getElementById("download-btn");console.log("Generated "+r.combined.length+" circles "),a.onclick=function(){var e={coordinates:r.combined,circleRadius:n};!function(e,t,n){var r=new Blob([e],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(r,t);else{var a=window.document.createElement("a");a.href=window.URL.createObjectURL(r),a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}}(JSON.stringify(e),"coords_"+e.coordinates.length+"_r"+n+".json","application/json")}}.bind(null,t,e),n.click()}.bind(null,m),v=m.clearLayers,r.on("draw:created",function(e){var t=e.layerType,n=e.layer;if("rectangle"!==t)return!0;a.clearLayers(),console.log(t+" drawn");var r=n.getLatLngs()[0];a.addLayer(n),console.log("Boundaries of the area of interest:"),console.log(JSON.stringify(r));var o=L.latLngBounds(r.map(function(e){return[e.lat,e.lng]})),i=L.rectangle(o);g(i)}),r.on("draw:deleted",v)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL21hcC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2VvX3V0aWxzLnRzIiwid2VicGFjazovLy8uL3NyYy9jb3JlLnRzIiwid2VicGFjazovLy8uL3NyYy9hcHAudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwidmFsdWUiLCJuIiwiX19lc01vZHVsZSIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIm1hcCIsImxheWVyRm9yVXNlclJlY3RhbmdsZXMiLCJMIiwic2V0VmlldyIsInRpbGVMYXllciIsImF0dHJpYnV0aW9uIiwibWF4Wm9vbSIsImlkIiwiYWNjZXNzVG9rZW4iLCJhZGRUbyIsImNvbnRyb2wiLCJzaWRlYmFyIiwiRmVhdHVyZUdyb3VwIiwiYWRkTGF5ZXIiLCJkcmF3Q29udHJvbCIsIkNvbnRyb2wiLCJEcmF3IiwiZWRpdCIsImZlYXR1cmVHcm91cCIsImRyYXciLCJjaXJjbGUiLCJjaXJjbGVtYXJrZXIiLCJtYXJrZXIiLCJwb2x5Z29uIiwicG9seWxpbmUiLCJkcmF3Q2lyY2xlcyIsImNvb3JkcyIsImxheWVyIiwiY2lyY2xlUmFkaXVzIiwiY2lyY2xlT3B0aW9ucyIsIm9wdHMiLCJfX2Fzc2lnbiIsImNvbG9yIiwiZm9yRWFjaCIsImNvb3JkIiwiQ2lyY2xlIiwiYWRkQ29udHJvbCIsIkVBUlRIX1JBRElVUyIsImNhbGN1bGF0ZU5leHRQb2ludCIsImNvb3JkaW5hdGUiLCJkaXN0YW5jZSIsImJlYXJpbmciLCJwMSIsInAyIiwiZGVsdGEiLCJOdW1iZXIiLCJ0aGV0YSIsInRvUmFkaWFucyIsInBoaTEiLCJsYXQiLCJsYW1iZGExIiwibG5nIiwic2lucGhpMSIsIk1hdGgiLCJzaW4iLCJjb3NwaGkxIiwiY29zIiwic2luZGVsdGEiLCJjb3NkZWx0YSIsInNpbnRoZXRhIiwic2lucGhpMiIsInBoaTIiLCJhc2luIiwieSIsIngiLCJsYW1iZGEyIiwiYXRhbjIiLCJkZXN0aW5hdGlvblBvaW50IiwibGF0TG5nIiwidG9EZWdyZWVzIiwicG9pbnQiLCJuZXdfYmVhcmluZyIsImRlbHRhT2ZMYW1iZGEiLCJiZWFyaW5nVG8iLCJpc1dpdGhpbkJvdW5kcyIsImJvdW5kcyIsIm51bSIsImlnbm9yZUxhc3RYRGlnaXRzIiwiYWRqdXN0UHJlY2lzaW9uIiwiaWdub3JlTGFzdFhTeW1ib2xzIiwicHJlY2lzaW9uIiwidG9TdHJpbmciLCJzcGxpdCIsImxlbmd0aCIsInBvdyIsImNlaWwiLCJyb3VuZFVwIiwiYWRqdXN0ZWRQcmVjaXNpb25Cb3VuZHMiLCJhZGp1c3RlZFByZWNpc2lvbk51bSIsIm1pbkxhdCIsIm1pbiIsImFwcGx5IiwibWF4TGF0IiwibWF4IiwiUEkiLCJCZWFyaW5nIiwiUmVjdGFuZ2xlU2lkZSIsImNhbGxiYWNrT25SZWN0RHJhd24iLCJjYWxsYmFja09uRGVsZXRlIiwiY2lyY2xlc0xheWVyIiwiY2lyY2xlQ29vcmRzT2ZSb3ciLCJpbml0aWFsQ29vcmQiLCJlYXN0Qm91bmQiLCJnZXRFYXN0IiwicmVzdWx0IiwiY3VycmVudFBvc2l0aW9uIiwicHVzaCIsImVhc3QiLCJtb3ZlVG9Tb3V0aEVhc3QiLCJjdXJyZW50Um93SW5pdGlhbCIsImRpc3QiLCJzb3V0aCIsIiQiLCJhdHRyIiwiZHJhd25SZWN0YW5nbGUiLCJjbGVhckxheWVycyIsInJlZHJhd0J0biIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJvbmNsaWNrIiwiYm91bmRpbmdSZWN0YW5nbGUiLCJjaXJjbGVfcmFkaXVzIiwidmFsIiwiY29uc29sZSIsImxvZyIsIm9wdGlvbnMiLCJmaWxsZXJzIiwicmVjdEJvdW5kcyIsImdldEJvdW5kcyIsImluaXRpYWxQb2ludCIsImZyZWV6ZSIsImdldE5vcnRoV2VzdCIsImN1cnJlbnRDb29yZCIsInJvdyIsImN1cnJlbnRSb3dDaXJjbGVzQ29vcmRzIiwiZmlsbGVyRmlyc3RDb29yZCIsImdldE5vcnRoIiwiZ2V0U291dGgiLCJoZWxwZXJSb3dDb29yZHMiLCJwb3AiLCJtYWluIiwiY29tYmluZWQiLCJjb25jYXQiLCJjcmVhdGVDb29yZGluYXRlcyIsImRvd25sb2FkQnRuIiwidG9TYXZlIiwiY29vcmRpbmF0ZXMiLCJkYXRhIiwiZmlsZW5hbWUiLCJjb250ZW50VHlwZSIsImJsb2IiLCJCbG9iIiwidHlwZSIsIndpbmRvdyIsIm5hdmlnYXRvciIsIm1zU2F2ZU9yT3BlbkJsb2IiLCJtc1NhdmVCbG9iIiwiZWxlbSIsImNyZWF0ZUVsZW1lbnQiLCJocmVmIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiZG93bmxvYWQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJjbGljayIsInJlbW92ZUNoaWxkIiwic2F2ZUZpbGUiLCJKU09OIiwic3RyaW5naWZ5IiwiYmluZCIsIm9uIiwiZSIsImxheWVyVHlwZSIsImxhdGxuZ3MiLCJnZXRMYXRMbmdzIiwicmVjdGFuZ2xlQm91bmRzIiwibGF0TG5nQm91bmRzIiwicmVjdGFuZ2xlIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVB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VUMsR0FDN0IsSUFBSXBCLEVBQU9vQixFQUFFQyxVQUNUbEosRUFBUWlKLEVBQUVqSixNQUNkLEdBQWEsY0FBVDZILEVBQ0EsT0FBTyxFQUVYdkosRUFBdUJrSCxjQUN2QlEsUUFBUUMsSUFBSTRCLEVBQU8sVUFDbkIsSUFBSXNCLEVBQVVuSixFQUFNb0osYUFBYSxHQUNqQzlLLEVBQXVCWSxTQUFTYyxHQUVoQ2dHLFFBQVFDLElBQUksdUNBQ1pELFFBQVFDLElBQUk0QyxLQUFLQyxVQUFVSyxJQUczQixJQUFNRSxFQUFrQzlLLEVBQUUrSyxhQUFhSCxFQUFROUssSUFBSSxTQUFVa0MsR0FDekUsT0FBUUEsRUFBTWUsSUFBS2YsRUFBTWlCLFFBR3ZCcUUsRUFBaUN0SCxFQUFFZ0wsVUFBVUYsR0FHbkQvRSxFQUFvQnVCLEtBRXhCeEgsRUFBSTJLLEdBQUcsZUFBZ0J6RSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgbGV0IG1hcDtcbmV4cG9ydCBsZXQgbGF5ZXJGb3JVc2VyUmVjdGFuZ2xlcztcbmRlY2xhcmUgbGV0IEw7XG4vLyBhZGQgdGhlIG1hcCB0byB0aGUgcGFnZVxubWFwID0gTC5tYXAoJ21hcCcpLnNldFZpZXcoWzQyLjY5NzkzMCwgMjMuMzIxNjI4XSwgMTMpO1xuTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5wbmc/YWNjZXNzX3Rva2VuPXthY2Nlc3NUb2tlbn0nLCB7XG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGNyZWF0ZUNvb3JkaW5hdGVzUmV0dXJuIGhyZWY9XCJodHRwOi8vb3BlbnN0cmVldG1hcC5vcmdcIj5PcGVuU3RyZWV0TWFwPC9jcmVhdGVDb29yZGluYXRlc1JldHVybj4gY29udHJpYnV0b3JzLCA8Y3JlYXRlQ29vcmRpbmF0ZXNSZXR1cm4gaHJlZj1cImh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvY3JlYXRlQ29vcmRpbmF0ZXNSZXR1cm4+LCBJbWFnZXJ5IMKpIDxjcmVhdGVDb29yZGluYXRlc1JldHVybiBocmVmPVwiaHR0cDovL21hcGJveC5jb21cIj5NYXBib3g8L2NyZWF0ZUNvb3JkaW5hdGVzUmV0dXJuPicsXG4gICAgbWF4Wm9vbTogMTgsXG4gICAgaWQ6ICdtYXBib3guc3RyZWV0cy1iYXNpYycsXG4gICAgYWNjZXNzVG9rZW46ICdway5leUoxSWpvaVkyaHBjSE5oYmlJc0ltRWlPaUpxYTBKd1YxcG5JbjAubXZkdVd6eVJkY0h4S19RSU9wZXRGZydcbn0pLmFkZFRvKG1hcCk7XG5cblxuLy8gdGhlIGNvbGxhcHNpYmxlIHNpZGViYXIgd2l0aCByZWRyYXcvZG93bmxvYWQgZXRjLiBjdXN0b20gYnV0dG9uc1xubGV0IHNpZGViYXIgPSBMLmNvbnRyb2wuc2lkZWJhcignc2lkZWJhcicpLmFkZFRvKG1hcCk7XG5cbi8vIHdoZXJlIHdlIGRyYXcgcmVjdGFuZ2xlc1xubGF5ZXJGb3JVc2VyUmVjdGFuZ2xlcyA9IG5ldyBMLkZlYXR1cmVHcm91cCgpO1xubWFwLmFkZExheWVyKGxheWVyRm9yVXNlclJlY3RhbmdsZXMpO1xuLy8gZW5hYmxlIHRoZSBwbHVnaW4gZm9yIGRyYXdpbmcgb24gdGhlIG1hcFxubGV0IGRyYXdDb250cm9sID0gbmV3IEwuQ29udHJvbC5EcmF3KHtcbiAgICBlZGl0OiB7XG4gICAgICAgIGZlYXR1cmVHcm91cDogbGF5ZXJGb3JVc2VyUmVjdGFuZ2xlc1xuICAgIH0sXG4gICAgZHJhdzoge1xuICAgICAgICBjaXJjbGU6IGZhbHNlLFxuICAgICAgICBjaXJjbGVtYXJrZXI6IGZhbHNlLFxuICAgICAgICBtYXJrZXI6IGZhbHNlLFxuICAgICAgICBwb2x5Z29uOiBmYWxzZSxcbiAgICAgICAgcG9seWxpbmU6IGZhbHNlLFxuICAgIH1cbn0pO1xubWFwLmFkZENvbnRyb2woZHJhd0NvbnRyb2wpO1xuXG4vKipcbiAqIEEgZnVuY3Rpb24gd2hpY2ggY29sbGVjdHMgd2hhdCB0aGUgdXNlciBoYXMgZHJhd24gYW5kIHBhc3MgaXQgdG8gYSBjYWxsYmFja1xuICogQHBhcmFtIHsocmVjdGFuZ2xlOiBSZWN0YW5nbGUpID0+IGFueX0gY2FsbGJhY2tPblJlY3REcmF3blxuICogQHBhcmFtIHsoKSA9PiB2b2lkfSBjYWxsYmFja09uRGVsZXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVEcmF3aW5nKGNhbGxiYWNrT25SZWN0RHJhd246IChyZWN0YW5nbGU6IEwuUmVjdGFuZ2xlKSA9PiBhbnksIGNhbGxiYWNrT25EZWxldGU6ICgpID0+IHZvaWQpIHtcbiAgICAvLyB0b2RvIGhhbmRsZSBcImVkaXRlZFwiIHRvb1xuICAgIG1hcC5vbignZHJhdzpjcmVhdGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgbGV0IHR5cGUgPSBlLmxheWVyVHlwZSxcbiAgICAgICAgICAgIGxheWVyID0gZS5sYXllcjtcbiAgICAgICAgaWYgKHR5cGUgIT09IFwicmVjdGFuZ2xlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgbGF5ZXJGb3JVc2VyUmVjdGFuZ2xlcy5jbGVhckxheWVycygpO1xuICAgICAgICBjb25zb2xlLmxvZyh0eXBlICsgXCIgZHJhd25cIik7XG4gICAgICAgIGxldCBsYXRsbmdzID0gbGF5ZXIuZ2V0TGF0TG5ncygpWzBdO1xuICAgICAgICBsYXllckZvclVzZXJSZWN0YW5nbGVzLmFkZExheWVyKGxheWVyKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcIkJvdW5kYXJpZXMgb2YgdGhlIGFyZWEgb2YgaW50ZXJlc3Q6XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShsYXRsbmdzKSk7XG5cbiAgICAgICAgLy8gcHJlcGFyZSB0aGUgcmVzdWx0IHRvIGJlIHVzZWQgZm9yIGNvbnN0cnVjdGluZyBhIHJlY3RhbmdsZVxuICAgICAgICBjb25zdCByZWN0YW5nbGVCb3VuZHM6IEwuTGF0TG5nQm91bmRzID0gTC5sYXRMbmdCb3VuZHMobGF0bG5ncy5tYXAoZnVuY3Rpb24gKGNvb3JkKTogW251bWJlciwgbnVtYmVyXSB7XG4gICAgICAgICAgICByZXR1cm4gW2Nvb3JkLmxhdCwgY29vcmQubG5nXVxuICAgICAgICB9KSk7XG4gICAgICAgIC8vIG1ha2UgdGhlIHJlY3RhbmdsZSwgd2hpY2ggZW5jb21wYXNzZXMgdGhlIGFyZWEgd2hpY2ggd2Ugd2FudCB0byBmaWxsIHdpdGggY2lyY2xlc1xuICAgICAgICBjb25zdCBib3VuZGluZ1JlY3RhbmdsZTogTC5SZWN0YW5nbGUgPSBMLnJlY3RhbmdsZShyZWN0YW5nbGVCb3VuZHMpO1xuXG4gICAgICAgIC8vIHBhc3MgdGhlIHJlY3RhbmdsZSB0byB0aGUgY2FsbGJhY2tcbiAgICAgICAgY2FsbGJhY2tPblJlY3REcmF3bihib3VuZGluZ1JlY3RhbmdsZSk7XG4gICAgfSk7XG4gICAgbWFwLm9uKFwiZHJhdzpkZWxldGVkXCIsIGNhbGxiYWNrT25EZWxldGUpXG5cbn1cblxuLyoqXG4gKiBHaXZlbiBhIGxheWVyLCBjb29yZGluYXRlcyBvZiB0aGUgY2VudGVyIG9mIGNpcmNsZXMgYW5kIHRoZSByYWRpdXMgb2YgdGhlIGNpcmNsZSxcbiAqIGRyYXcgdGhlIGNpcmNsZXMgb24gdGhlIGxheWVyXG4gKiBAcGFyYW0ge0xhdExuZ1tdfSBjb29yZHNcbiAqIEBwYXJhbSB7TGF5ZXJHcm91cH0gbGF5ZXJcbiAqIEBwYXJhbSB7bnVtYmVyfSBjaXJjbGVSYWRpdXNcbiAqIEBwYXJhbSB7e319IGNpcmNsZU9wdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRyYXdDaXJjbGVzKGNvb3JkczogTC5MYXRMbmdbXSwgbGF5ZXI6IEwuTGF5ZXJHcm91cCwgY2lyY2xlUmFkaXVzID0gMzAwLCBjaXJjbGVPcHRpb25zID0ge30pIHtcbiAgICBsZXQgb3B0cyA9IHtcbiAgICAgICAgY29sb3I6IFwicmVkXCIsXG4gICAgICAgIC4uLmNpcmNsZU9wdGlvbnNcbiAgICB9O1xuICAgIGNvb3Jkcy5mb3JFYWNoKChjb29yZDogTC5MYXRMbmcpID0+IHtcbiAgICAgICAgbmV3IEwuQ2lyY2xlKGNvb3JkLCBjaXJjbGVSYWRpdXMsIG9wdHMpLmFkZFRvKGxheWVyKVxuICAgIH0pXG59XG5cblxuXG4iLCIvKlxuICogIENyZWRpdHM6IGh0dHA6Ly93d3cubW92YWJsZS10eXBlLmNvLnVrL3NjcmlwdHMvbGF0bG9uZy5odG1sXG4gKiAtPiBsYXRsb24tc3BoZXJpY2FsLmpzXG4gKi9cbmRlY2xhcmUgbGV0IEw7XG5jb25zdCBFQVJUSF9SQURJVVMgPSA2MzcxZTM7XG5cbi8qKlxuICogXCJEZXN0aW5hdGlvbiBwb2ludCBnaXZlbiBkaXN0YW5jZSBhbmQgYmVhcmluZyBmcm9tIHN0YXJ0IHBvaW50XCJcblxuICogQHBhcmFtIGNvb3JkaW5hdGUgOiB0aGUgc3RhcnQgcG9pbnRcbiAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSwgaW4gbWV0cmVzXG4gKiBAcGFyYW0ge251bWJlcn0gYmVhcmluZyAtIGRpcmVjdGlvbiwgaW4gZGVncmVlcyBmcm9tIG5vcnRoIGNsb2Nrd2lzZVxuICogQHJldHVybiB0aGUgbmV3IHBvaW50IGFuZCB0aGUgbmV3IGJlYXJpbmdcbiAqICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlTmV4dFBvaW50KGNvb3JkaW5hdGU6IEwuTGF0TG5nLCBkaXN0YW5jZSA9IDUwMCwgYmVhcmluZyk6IHsgcG9pbnQ6IEwuTGF0TG5nLCBuZXdfYmVhcmluZzogbnVtYmVyIH0ge1xuXG4gICAgLy8gc2luz4YyID0gc2luz4Yx4ouFY29zzrQgKyBjb3PPhjHii4VzaW7OtOKLhWNvc864XG4gICAgLy8gdGFuzpTOuyA9IHNpbs644ouFc2luzrTii4Vjb3PPhjEgLyBjb3POtOKIknNpbs+GMeKLhXNpbs+GMlxuICAgIC8vIHNlZSBtYXRoZm9ydW0ub3JnL2xpYnJhcnkvZHJtYXRoL3ZpZXcvNTIwNDkuaHRtbCBmb3IgZGVyaXZhdGlvblxuXG4gICAgbGV0IGRlbHRhID0gTnVtYmVyKGRpc3RhbmNlKSAvIEVBUlRIX1JBRElVUzsgLy8gYW5ndWxhciBkaXN0YW5jZSBpbiByYWRpYW5zXG4gICAgbGV0IHRoZXRhID0gdG9SYWRpYW5zKE51bWJlcihiZWFyaW5nKSk7XG5cbiAgICBsZXQgcGhpMSA9IHRvUmFkaWFucyhjb29yZGluYXRlLmxhdCk7XG4gICAgbGV0IGxhbWJkYTEgPSB0b1JhZGlhbnMoY29vcmRpbmF0ZS5sbmcpO1xuXG4gICAgbGV0IHNpbnBoaTEgPSBNYXRoLnNpbihwaGkxKSwgY29zcGhpMSA9IE1hdGguY29zKHBoaTEpO1xuICAgIGxldCBzaW5kZWx0YSA9IE1hdGguc2luKGRlbHRhKSwgY29zZGVsdGEgPSBNYXRoLmNvcyhkZWx0YSk7XG4gICAgbGV0IHNpbnRoZXRhID0gTWF0aC5zaW4odGhldGEpLCBjb3N0aGV0YSA9IE1hdGguY29zKHRoZXRhKTtcblxuICAgIGxldCBzaW5waGkyID0gc2lucGhpMSAqIGNvc2RlbHRhICsgY29zcGhpMSAqIHNpbmRlbHRhICogY29zdGhldGE7XG4gICAgbGV0IHBoaTIgPSBNYXRoLmFzaW4oc2lucGhpMik7XG4gICAgbGV0IHkgPSBzaW50aGV0YSAqIHNpbmRlbHRhICogY29zcGhpMTtcbiAgICBsZXQgeCA9IGNvc2RlbHRhIC0gc2lucGhpMSAqIHNpbnBoaTI7XG4gICAgbGV0IGxhbWJkYTIgPSBsYW1iZGExICsgTWF0aC5hdGFuMih5LCB4KTtcblxuICAgIGNvbnN0IGRlc3RpbmF0aW9uUG9pbnQgPSBMLmxhdExuZyh0b0RlZ3JlZXMocGhpMiksICh0b0RlZ3JlZXMobGFtYmRhMikgKyA1NDApICUgMzYwIC0gMTgwKTsgLy8gbm9ybWFsaXNlIHRvIOKIkjE4MC4uKzE4MMKwLFxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcG9pbnQ6IGRlc3RpbmF0aW9uUG9pbnQsXG4gICAgICAgIG5ld19iZWFyaW5nOiBmaW5hbEJlYXJpbmdUbyhjb29yZGluYXRlLCBkZXN0aW5hdGlvblBvaW50KVxuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzV2l0aGluQm91bmRzKGJvdW5kczogW251bWJlciwgbnVtYmVyXSwgbnVtOiBudW1iZXIsIGlnbm9yZUxhc3RYRGlnaXRzID0gNSkge1xuICAgIGNvbnN0IGFkanVzdFByZWNpc2lvbiA9IChuKSA9PiByZW1vdmVMYXN0WERpZ2l0cyhuLCBpZ25vcmVMYXN0WERpZ2l0cyk7XG5cbiAgICBsZXQgYWRqdXN0ZWRQcmVjaXNpb25Cb3VuZHMgPSBib3VuZHMubWFwKGFkanVzdFByZWNpc2lvbik7XG4gICAgbGV0IGFkanVzdGVkUHJlY2lzaW9uTnVtID0gYWRqdXN0UHJlY2lzaW9uKG51bSk7XG5cbiAgICBsZXQgbWluTGF0ID0gTWF0aC5taW4oLi4uYWRqdXN0ZWRQcmVjaXNpb25Cb3VuZHMpLCBtYXhMYXQgPSBNYXRoLm1heCguLi5hZGp1c3RlZFByZWNpc2lvbkJvdW5kcyk7XG5cbiAgICByZXR1cm4gKG1pbkxhdCA8PSBhZGp1c3RlZFByZWNpc2lvbk51bSkgJiYgKGFkanVzdGVkUHJlY2lzaW9uTnVtIDw9IG1heExhdCk7XG59XG5cblxuZnVuY3Rpb24gZmluYWxCZWFyaW5nVG8ocDEsIHAyKSB7XG4gICAgcmV0dXJuIChiZWFyaW5nVG8ocDIsIHAxKSArIDE4MCkgJSAzNjA7XG59XG5cbmZ1bmN0aW9uIGJlYXJpbmdUbyhwMSwgcDIpIHtcbiAgICAvLyB0YW7OuCA9IHNpbs6Uzrvii4Vjb3PPhjIgLyBjb3PPhjHii4VzaW7PhjIg4oiSIHNpbs+GMeKLhWNvc8+GMuKLhWNvc86UzrtcbiAgICAvLyBzZWUgbWF0aGZvcnVtLm9yZy9saWJyYXJ5L2RybWF0aC92aWV3LzU1NDE3Lmh0bWwgZm9yIGRlcml2YXRpb25cblxuICAgIGxldCBwaGkxID0gdG9SYWRpYW5zKHAxLmxhdCksIHBoaTIgPSB0b1JhZGlhbnMocDIubGF0KTtcbiAgICBsZXQgZGVsdGFPZkxhbWJkYSA9IHRvUmFkaWFucyhwMi5sbmcgLSBwMS5sbmcpO1xuICAgIGxldCB5ID0gTWF0aC5zaW4oZGVsdGFPZkxhbWJkYSkgKiBNYXRoLmNvcyhwaGkyKTtcbiAgICBsZXQgeCA9IE1hdGguY29zKHBoaTEpICogTWF0aC5zaW4ocGhpMikgLVxuICAgICAgICBNYXRoLnNpbihwaGkxKSAqIE1hdGguY29zKHBoaTIpICogTWF0aC5jb3MoZGVsdGFPZkxhbWJkYSk7XG4gICAgbGV0IHRoZXRhID0gTWF0aC5hdGFuMih5LCB4KTtcblxuICAgIHJldHVybiAodG9EZWdyZWVzKHRoZXRhKSArIDM2MCkgJSAzNjA7XG59XG5cbmZ1bmN0aW9uIHRvUmFkaWFucyhudW0pIHtcbiAgICByZXR1cm4gbnVtICogTWF0aC5QSSAvIDE4MFxufVxuXG5mdW5jdGlvbiB0b0RlZ3JlZXMobnVtKSB7XG4gICAgcmV0dXJuIG51bSAqIDE4MCAvIE1hdGguUElcbn1cblxuLyoqXG4gKiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81MTkxMDg4L2hvdy10by1yb3VuZC11cC1hLW51bWJlci1pbi1qYXZhc2NyaXB0XG4gKiBAcGFyYW0gbnVtIFRoZSBudW1iZXIgdG8gcm91bmRcbiAqIEBwYXJhbSBwcmVjaXNpb24gVGhlIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlcyB0byBwcmVzZXJ2ZVxuICovXG5mdW5jdGlvbiByb3VuZFVwKG51bSwgcHJlY2lzaW9uKSB7XG4gICAgcHJlY2lzaW9uID0gTWF0aC5wb3coMTAsIHByZWNpc2lvbik7XG4gICAgcmV0dXJuIE1hdGguY2VpbChudW0gKiBwcmVjaXNpb24pIC8gcHJlY2lzaW9uXG59XG5cbmZ1bmN0aW9uIHJlbW92ZUxhc3RYRGlnaXRzKG51bSwgaWdub3JlTGFzdFhTeW1ib2xzKSB7XG4gICAgbGV0IHByZWNpc2lvbiA9IG51bS50b1N0cmluZygpLnNwbGl0KCcuJylbMV0ubGVuZ3RoO1xuICAgIHJldHVybiByb3VuZFVwKG51bSwgcHJlY2lzaW9uIC0gaWdub3JlTGFzdFhTeW1ib2xzKVxufVxuXG4iLCJpbXBvcnQge2NhbGN1bGF0ZU5leHRQb2ludCwgaXNXaXRoaW5Cb3VuZHN9IGZyb20gXCIuL2dlb191dGlsc1wiO1xuXG5leHBvcnQgY29uc3QgREVGQVVMVF9DSVJDTEVfUkFESVVTID0gMTUwOyAvLyBtZXRlcnNcbmRlY2xhcmUgbGV0IEw7XG5cbnR5cGUgY3JlYXRlQ29vcmRpbmF0ZXNPcHRzID0ge1xuICAgIGJvdW5kaW5nUmVjdGFuZ2xlOiBMLlJlY3RhbmdsZSxcbiAgICBkaXN0YW5jZTogbnVtYmVyLFxufVxudHlwZSBjcmVhdGVDb29yZGluYXRlc1JldHVybiA9IHsgbWFpbjogTC5MYXRMbmdbXSwgZmlsbGVyczogTC5MYXRMbmdbXSwgY29tYmluZWQ6IEwuTGF0TG5nW10gfTtcblxuLyoqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHRoZSBjb3JlIG9mIHRoZSB3aG9sZSByZXBvLlxuICpcbiAqIFRoZSBmdW5jdGlvbiByZWNlaXZlcyBjcmVhdGVDb29yZGluYXRlc1JldHVybiByZWN0YW5nbGUgYW5kIHdhbnRzIHRvIGZpZ3VyZSBvdXRcbiAqIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgY2VudGVycyBvZiBjaXJjbGVzLCBzdWNoIHRoYXQgdGhlIGNpcmNsZXMgZmlsbCBvdXQgdGhlIHdob2xlIHJlY3RhbmdsZS5cbiAqIFdlIGFsbG93IGZvciB0aGUgY2lyY2xlcyB0byBvdmVybGFwLlxuICpcbiAqIEFsbCBjaXJjbGVzIGRpc2N1c3NlZCBiZWxvdyBoYXZlIHRoZSBzYW1lIHJhZGl1cyAoUiA9IEBvcHRpb25zLmRpc3QvMikuXG4gKlxuICogVGhlIGZ1bmN0aW9uIFwiaXRlcmF0ZXNcIiB0aGUgcmVjdGFuZ2xlIGZyb20gd2VzdC10by1lYXN0LCBub3J0aC10by1zb3V0aC5cbiAqIEEgcm93IGlzIGNyZWF0ZUNvb3JkaW5hdGVzUmV0dXJuIFwibGluZVwiIGZyb20gd2VzdC10by1lYXN0LlxuICpcbiAqIE9uIGVhY2ggcm93IHRoZSBjaXJjbGVzIGFyZSBuZXh0IHRvIGVhY2ggb3RoZXIsIHdpdGhvdXQgb3ZlcmxhcHBpbmcgKGkuZS4gMCBkaXN0YW5jZSBiL3cgY2lyY2xlcyBvbiBjcmVhdGVDb29yZGluYXRlc1JldHVybiByb3cpXG4gKiBUaGVyZSdzIG5vIGRpc3RhbmNlIGJldHdlZW4gY2lyY2xlcyBvbiBhZGphY2VudCBjb2x1bW5zIHRvby5cbiAqIFRoaXMgbWVhbnMgdGhhdCB0aGVzZSBcIm1haW5cIiBjaXJjbGVzIHdpbGwgbm90IGZpbGwgdXAgdGhlIHdob2xlIHJlY3RhbmdsZS5cbiAqXG4gKiBUaHVzLCBiZXR3ZWVuIGVhY2ggdHdvIGFkamFjZW50IFwibWFpblwiIHJvd3MgKGUuZy4gcm93cyBBIGFuZCBCKSAgd2UgaW5zZXJ0IGNyZWF0ZUNvb3JkaW5hdGVzUmV0dXJuIGZpbGxlciByb3cgKEYpLlxuICogUm93IEYgaXMgZWZmZWN0aXZlbHkgY29weSBvZiBBIGJ1dCBzaGlmdGVkIGZpcnN0IHNvdXRoIGFuZCB0aGVuIGVhc3QgYnkgdGhlIHJhZGl1cyBSLiBUaGUgbGFzdCBlbGVtZW50IG9mIHRoZSBmaWxsZXJcbiAqIHJvdyBpcyByZW1vdmVkIHNpbmNlIGl0J3MgdG9vIGZhciBmcm9tIHRoZSBlYXN0IGVuZCBvZiB0aGUgYm91bmRpbmcgcmVjdGFuZ2xlLlxuICpcbiAqIEBwYXJhbSB7Y3JlYXRlQ29vcmRpbmF0ZXNPcHRzfSBvcHRpb25zLiAuZGlzdCBpcyB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0aGUgY2VudGVycyBvZiB0d28gY2lyY2xlcy4gaS5lLiBpdCBpcyB0aGUgcmFkaXVzIG9mIGNyZWF0ZUNvb3JkaW5hdGVzUmV0dXJuIGNpcmNsZVxuICogQHJldHVybiB7Y3JlYXRlQ29vcmRpbmF0ZXNSZXR1cm59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb29yZGluYXRlcyhvcHRpb25zOiBjcmVhdGVDb29yZGluYXRlc09wdHMpOiBjcmVhdGVDb29yZGluYXRlc1JldHVybiB7XG4gICAgY29uc3QgcmVzdWx0OiBMLkxhdExuZ1tdID0gW10sIGZpbGxlcnM6IEwuTGF0TG5nW10gPSBbXTtcblxuICAgIGNvbnN0IHJlY3RCb3VuZHMgPSBvcHRpb25zLmJvdW5kaW5nUmVjdGFuZ2xlLmdldEJvdW5kcygpO1xuICAgIGNvbnN0IGluaXRpYWxQb2ludCA9IE9iamVjdC5mcmVlemUocmVjdEJvdW5kcy5nZXROb3J0aFdlc3QoKSk7XG5cbiAgICBsZXQgY3VycmVudENvb3JkOiBMLkxhdExuZyA9IGluaXRpYWxQb2ludDtcbiAgICBsZXQgY3VycmVudFJvd0luaXRpYWwgPSBjdXJyZW50Q29vcmQ7XG4gICAgZm9yIChsZXQgcm93ID0gMTsgOyByb3crKykge1xuXG4gICAgICAgIGxldCBjdXJyZW50Um93Q2lyY2xlc0Nvb3JkcyA9IGNpcmNsZUNvb3Jkc09mUm93KHJlY3RCb3VuZHMsIGN1cnJlbnRSb3dJbml0aWFsLCBvcHRpb25zLmRpc3RhbmNlKTtcbiAgICAgICAgcmVzdWx0LnB1c2goLi4uY3VycmVudFJvd0NpcmNsZXNDb29yZHMpO1xuXG4gICAgICAgIGxldCBmaWxsZXJGaXJzdENvb3JkID0gbW92ZVRvU291dGhFYXN0KGN1cnJlbnRSb3dJbml0aWFsLCBvcHRpb25zLmRpc3RhbmNlKTtcblxuICAgICAgICBpZiAoIWlzV2l0aGluQm91bmRzKFtyZWN0Qm91bmRzLmdldE5vcnRoKCksIHJlY3RCb3VuZHMuZ2V0U291dGgoKV0sIGN1cnJlbnRDb29yZC5sYXQpKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBoZWxwZXJSb3dDb29yZHM6IEwuTGF0TG5nW10gPSBjaXJjbGVDb29yZHNPZlJvdyhyZWN0Qm91bmRzLCBmaWxsZXJGaXJzdENvb3JkLCBvcHRpb25zLmRpc3RhbmNlKTtcbiAgICAgICAgICAgIGhlbHBlclJvd0Nvb3Jkcy5wb3AoKTtcbiAgICAgICAgICAgIGZpbGxlcnMucHVzaCguLi5oZWxwZXJSb3dDb29yZHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudFJvd0luaXRpYWwgPSBjdXJyZW50Q29vcmQgPSBjYWxjdWxhdGVOZXh0UG9pbnQoaW5pdGlhbFBvaW50LCBvcHRpb25zLmRpc3RhbmNlICogcm93LCBCZWFyaW5nLnNvdXRoKS5wb2ludDtcbiAgICB9XG4gICAgcmV0dXJuIHttYWluOiByZXN1bHQsIGZpbGxlcnM6IGZpbGxlcnMsIGNvbWJpbmVkOiByZXN1bHQuY29uY2F0KGZpbGxlcnMpfVxuXG59XG5cbi8qKlxuICogKGdlbmVyYXRlcyByb3dzIGZvciBjcmVhdGVDb29yZGluYXRlcygpKVxuICogR2VuZXJhdGUgdGhlIGNvb3JkaW5hdGVzIG9mIGNpcmNsZXMgb24gY3JlYXRlQ29vcmRpbmF0ZXNSZXR1cm4gZ2VuZXJpYyByb3cgKGkuZS4gdXNlZCBmb3IgYm90aCBcIm1haW5cIi9cImZpbGxlclwiIHJvd3MpLlxuICpcbiAqIFRoZSBmdW5jdGlvbiBzdGFydHMgZnJvbSBjcmVhdGVDb29yZGluYXRlc1JldHVybiBnaXZlbiBAaW5pdGlhbENvb3JkIGFuZCBtb3ZlcyBlYXN0LiBPbiBlYWNoIGl0ZXJhdGlvbiBpdCBjaGVja3MgaWYgdGhlIGN1cnJlbnRcbiAqIGNvb3JkaW5hdGUgaXMgd2l0aGluIHRoZSBsb25naXR1ZGUgYm91bmRzIG9mIHRoZSByZWN0IChpLmUuIGF0IG1vc3Qgb25lIGNpcmNsZSBiZXlvbmQgdGhlIGVhc3Qgc2lkZSBvZiB0aGUgcmVjdCkuXG4gKiBJZiBpdCdzIGJleW9uZCAtIHRoZSBmdW5jdGlvbiByZXR1cm5zIHRoZSByb3cuIFNpbmNlIHdlIGFkZCB0byB0aGUgcmVzdWx0IGJlZm9yZSB3ZSBtYWtlIHRoZSBib3VuZCBjaGVjayxcbiAqIHdlIGFsbG93IGZvciBhdCBtb3N0IG9uZSBjaXJjbGUgYmV5b25kIHRoZSBib3VuZHMuXG4gKlxuICogQHBhcmFtIHtMYXRMbmdCb3VuZHN9IGJvdW5kcyAtIHRoZSBib3VuZHMgb2YgdGhlIGJpZyByZWN0YW5nbGUgYXJvdW5kIHRoZSBjaXR5XG4gKiBAcGFyYW0ge0xhdExuZ30gaW5pdGlhbENvb3JkIC0gd2hlcmUgaXMgdGhlIGNlbnRyZSBvZiB0aGUgZmlyc3QgY2lyY2xlIG9uIHRoYXQgcm93XG4gKiBAcGFyYW0gZGlzdGFuY2UgLSB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0aGUgY2VudGVycyBvZiB0d28gYWRqYWNlbnQgY2lyY2xlcyBvbiB0aGlzIHJvd1xuICogQHJldHVybiB7TGF0TG5nW119IHRoZSBjb29yZGluYXRlcyBvZiB0aGUgY2VudGVycyBvZiBhbGwgY2lyY2xlcyBvbiB0aGlzIHJvd1xuICovXG5mdW5jdGlvbiBjaXJjbGVDb29yZHNPZlJvdyhib3VuZHM6IEwuTGF0TG5nQm91bmRzLCBpbml0aWFsQ29vcmQ6IEwuTGF0TG5nLCBkaXN0YW5jZSkge1xuICAgIGNvbnN0IGVhc3RCb3VuZCA9IGJvdW5kcy5nZXRFYXN0KCk7XG5cbiAgICBsZXQgcmVzdWx0OiBMLkxhdExuZ1tdID0gW107XG4gICAgbGV0IGN1cnJlbnRQb3NpdGlvbjogTC5MYXRMbmcgPSBpbml0aWFsQ29vcmQ7XG4gICAgZm9yICg7IDspIHtcbiAgICAgICAgcmVzdWx0LnB1c2goY3VycmVudFBvc2l0aW9uKTtcbiAgICAgICAgLypcbiAgICAgICAgdXNlIGluaXRpYWxDb29yZC5sbmcgaW5zdGVhZCBvZiBcIndlc3RCb3VuZFwiIGJlY2F1c2Ugb2YgY3JlYXRlQ29vcmRpbmF0ZXNSZXR1cm4gbnVtZXJpY2FsIGVycm9yIHByb3BhZ2F0ZWQgdXAgZnJvbSBjYWxjdWxhdGVOZXh0UG9pbnQoKS5cbiAgICAgICAgdGhlIGVycm9yIGluY3JlYXNlcyB0aGUgbW9yZSB3ZSBnbyBzb3V0aCBmcm9tIHRoZSBub3J0aC13ZXN0IHBvaW50IG9mIEBib3VuZHMuXG5cbiAgICAgICAgdGw7ZHIgaXQncyBkdWUgdG8gdGhlIGZhY3QgdGhhdCB0aGUgZWFydGggaGFzIGFuIGltcGVyZmVjdCBzaGFwZVxuICAgICAgICAqL1xuICAgICAgICBpZiAoIWlzV2l0aGluQm91bmRzKFtpbml0aWFsQ29vcmQubG5nLCBlYXN0Qm91bmRdLCBjdXJyZW50UG9zaXRpb24ubG5nKSkge1xuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50UG9zaXRpb24gPSBjYWxjdWxhdGVOZXh0UG9pbnQoY3VycmVudFBvc2l0aW9uLCBkaXN0YW5jZSwgQmVhcmluZy5lYXN0KS5wb2ludDtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBtb3ZlVG9Tb3V0aEVhc3QoY3VycmVudFJvd0luaXRpYWwsIGRpc3QpIHtcbiAgICBsZXQgc2hpZnRTb3V0aCA9IGNhbGN1bGF0ZU5leHRQb2ludChjdXJyZW50Um93SW5pdGlhbCwgZGlzdCAvIDIsIEJlYXJpbmcuc291dGgpLnBvaW50O1xuICAgIHJldHVybiBjYWxjdWxhdGVOZXh0UG9pbnQoc2hpZnRTb3V0aCwgZGlzdCAvIDIsIEJlYXJpbmcuZWFzdCkucG9pbnQ7XG59XG5cbi8vIGkuZS4gZGlyZWN0aW9uXG5lbnVtIEJlYXJpbmcge1xuICAgIGVhc3QgPSA5MCxcbiAgICB3ZXN0ID0gLTkwLFxuXG4gICAgbm9ydGggPSAwLFxuICAgIHNvdXRoID0gMTgwXG59XG5cbmVudW0gUmVjdGFuZ2xlU2lkZSB7XG4gICAgLy8gdG9kbyBhZGQgb3RoZXJzXG4gICAgbm9ydGhXZXN0ID0gXCJOb3J0aFdlc3RcIlxufVxuXG5cblxuIiwiaW1wb3J0IHttYXAsIGRyYXdDaXJjbGVzLCBlbmFibGVEcmF3aW5nfSBmcm9tIFwiLi9tYXBcIlxuaW1wb3J0IHtERUZBVUxUX0NJUkNMRV9SQURJVVMsIGNyZWF0ZUNvb3JkaW5hdGVzfSBmcm9tIFwiLi9jb3JlXCJcblxuZGVjbGFyZSBsZXQgJDsgLy8ganF1ZXJ5IGFuZCBsZWFmbGV0IGFyZSBcImltcG9ydGVkXCIgaW4gdGhlIGh0bWwgdmlhIDxzY3JpcHQ+XG5kZWNsYXJlIGxldCBMO1xuXG5cbi8qKlxuICogT3JjaGVzdHJhdGUgaXQgYWxsXG4gKi9cbihmdW5jdGlvbiBydW4oKSB7XG4gICAgLy8gdGhlIGxlYWZsZXQgbGF5ZXIgb24gd2hpY2ggdGhlIGNpcmNsZXMgZ2VuZXJhdGVkIGNpcmNsZXMgd2lsbCBiZSBkcmF3blxuICAgIGNvbnN0IGNpcmNsZXNMYXllciA9IG5ldyBMLkZlYXR1cmVHcm91cCgpLmFkZFRvKG1hcCk7XG5cbiAgICAvLyBzZXQgZGVmYXVsdCBjaXJjbGUgcmFkaXVzXG4gICAgJChcIiNyYWRpdXMtc2l6ZVwiKS5hdHRyKFwidmFsdWVcIiwgREVGQVVMVF9DSVJDTEVfUkFESVVTKTtcblxuICAgIC8vIGF0dGFjaCBhIGNhbGxiYWNrIHRvIHRoZSBldmVudCB3aGVuIGEgdXNlciBoYXMgZHJhd24gYSByZWN0YW5nbGUgb24gdGhlIG1hcC5cbiAgICAvLyB0aGUgZGVmaW5pbmcgY29vcmRzIG9mIHRoZSByZWN0YW5nbGUgYXJlIHRoZW4gcGFzc2VkIHRvIGEgY2FsbGJhY2sgdGhhdCB3ZSBzZXQgaGVyZVxuICAgIGVuYWJsZURyYXdpbmcoXG4gICAgICAgIG9uQ2l0eUJvdW5kYXJ5UmVhZHkuYmluZChudWxsLCBjaXJjbGVzTGF5ZXIpLFxuICAgICAgICBjaXJjbGVzTGF5ZXIuY2xlYXJMYXllcnMpO1xufSkoKTtcblxuLyoqXG4gKiBHaXZlbiBhIGJvdW5kaW5nIHJlY3RhbmdsZSBhbmQgYSBcImNhbnZhc1wiLCBnZW5lcmF0ZWQgdGhlIGNpcmNsZXMgYW5kIGZpbGwgdGhlIGNhbnZhcyB3aXRoIHRoZW1cbiAqXG4gKiBAcGFyYW0ge1JlY3RhbmdsZX0gYm91bmRpbmdSZWN0YW5nbGVcbiAqIEBwYXJhbSBjaXJjbGVzTGF5ZXIgLSB0aGUgXCJjYW52YXNcIlxuICovXG5mdW5jdGlvbiByZWdlbmVyYXRlKGJvdW5kaW5nUmVjdGFuZ2xlOiBMLlJlY3RhbmdsZSwgY2lyY2xlc0xheWVyKSB7XG4gICAgLy8gd2lwZSBvdXQgZXhpc3RpbmcgY2lyY2xlc1xuICAgIGNpcmNsZXNMYXllci5jbGVhckxheWVycygpO1xuXG4gICAgLy8gdGhlIHJhZGl1cyBvZiB0aGUgY2lyY2xlcyB0aGF0IHdpbGwgZmlsbCB0aGUgcmVjdGFuZ2xlXG4gICAgY29uc3QgY2lyY2xlX3JhZGl1cyA9IGdldFVzZXJTZWxlY3RlZENpcmNsZVJhZGl1cygpOyAvLyBtZXRyZXNcbiAgICBjb25zb2xlLmxvZyhgJHtjaXJjbGVfcmFkaXVzfW0gY2lyY2xlIHJhZGl1c2ApO1xuXG4gICAgLy8gZ2VuZXJhdGUgYWxsIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgY2lyY2xlcyB3aXRoaW4gdGhlIGJvdW5kaW5nIGFyZWFcbiAgICAvLyAqb25seSogdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSAqY2VudGVyKiBvZiB0aGUgY2lyY2xlcyBpcyByZXR1cm5lZFxuICAgIGNvbnN0IGNvb3JkcyA9IGNyZWF0ZUNvb3JkaW5hdGVzKHtcbiAgICAgICAgYm91bmRpbmdSZWN0YW5nbGU6IGJvdW5kaW5nUmVjdGFuZ2xlLFxuICAgICAgICBkaXN0YW5jZTogY2lyY2xlX3JhZGl1cyAqIDIsXG4gICAgfSk7XG4gICAgLy8gLm1haW4gJiAuZmlsbGVycyBpcyB1c2VkIHRvIGRlYnVnIGVhc2lseS4gVGhlIHVuaW9uIG9mIHRoZSB0d28gc2V0cyBvZiBjaXJjbGVzXG4gICAgLy8gaXMgaW4gLmNvbWJpbmVkXG4gICAgZHJhd0NpcmNsZXMoY29vcmRzLm1haW4sIGNpcmNsZXNMYXllciwgY2lyY2xlX3JhZGl1cyk7XG4gICAgZHJhd0NpcmNsZXMoY29vcmRzLmZpbGxlcnMsIGNpcmNsZXNMYXllciwgY2lyY2xlX3JhZGl1cywge2NvbG9yOiAnZ3JlZW4nfSk7XG5cbiAgICBsZXQgZG93bmxvYWRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtYnRuJyk7XG5cbiAgICBjb25zb2xlLmxvZyhgR2VuZXJhdGVkICR7Y29vcmRzLmNvbWJpbmVkLmxlbmd0aH0gY2lyY2xlcyBgKTtcblxuICAgIGRvd25sb2FkQnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHRvU2F2ZSA9IHtcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBjb29yZHMuY29tYmluZWQsXG4gICAgICAgICAgICBjaXJjbGVSYWRpdXM6IGNpcmNsZV9yYWRpdXNcbiAgICAgICAgfTtcbiAgICAgICAgc2F2ZUZpbGUoSlNPTi5zdHJpbmdpZnkodG9TYXZlKSwgYGNvb3Jkc18ke3RvU2F2ZS5jb29yZGluYXRlcy5sZW5ndGh9X3Ike2NpcmNsZV9yYWRpdXN9Lmpzb25gLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIH07XG59XG5cblxuLyoqXG4gKiBDYWxsZWQgd2hlbiB0aGUgdXNlciBoYXMgZHJhd24gYSByZWN0YW5nbGVcbiAqIEBwYXJhbSBjaXJjbGVzTGF5ZXIgdGhlIGxheWVyIG9uIHdoaWNoIHdlIHdhbnQgdG8gZHJhdyB0aGUgZ2VuZXJhdGVkIGNpcmNsZXNcbiAqIEBwYXJhbSB7TGF0TG5nW119IGRyYXduUmVjdGFuZ2xlXG4gKi9cbmZ1bmN0aW9uIG9uQ2l0eUJvdW5kYXJ5UmVhZHkoY2lyY2xlc0xheWVyLCBkcmF3blJlY3RhbmdsZTogTC5SZWN0YW5nbGUpIHtcbiAgICBjaXJjbGVzTGF5ZXIuY2xlYXJMYXllcnMoKTtcblxuICAgIGNvbnN0IHJlZHJhd0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWdlbmVyYXRlLWJ0bicpO1xuICAgIHJlZHJhd0J0bi5vbmNsaWNrID0gcmVnZW5lcmF0ZS5iaW5kKG51bGwsIGRyYXduUmVjdGFuZ2xlLCBjaXJjbGVzTGF5ZXIpO1xuICAgIHJlZHJhd0J0bi5jbGljaygpO1xufVxuXG5mdW5jdGlvbiBnZXRVc2VyU2VsZWN0ZWRDaXJjbGVSYWRpdXMoKSB7XG4gICAgcmV0dXJuIE51bWJlcigkKFwiI3JhZGl1cy1zaXplXCIpLnZhbCgpKTtcbn1cblxuXG4vKipcbiAqIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zMzU0MjQ5OVxuICogU2F2ZSBhIGZpbGUgdG8gdGhlIGxvY2FsIGZpbGVzeXN0ZW1cbiAqIEBwYXJhbSBkYXRhXG4gKiBAcGFyYW0gZmlsZW5hbWVcbiAqIEBwYXJhbSBjb250ZW50VHlwZVxuICovXG5mdW5jdGlvbiBzYXZlRmlsZShkYXRhLCBmaWxlbmFtZSwgY29udGVudFR5cGUpIHtcbiAgICBsZXQgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwge3R5cGU6IGNvbnRlbnRUeXBlfSk7XG4gICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYikge1xuICAgICAgICB3aW5kb3cubmF2aWdhdG9yLm1zU2F2ZUJsb2IoYmxvYiwgZmlsZW5hbWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IGVsZW0gPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICBlbGVtLmhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgZWxlbS5kb3dubG9hZCA9IGZpbGVuYW1lO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW0pO1xuICAgICAgICBlbGVtLmNsaWNrKCk7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7XG4gICAgfVxufVxuXG5cbiJdLCJzb3VyY2VSb290IjoiIn0=